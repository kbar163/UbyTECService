--Procedimiento almacenado creado en la base de datos
-- ubytecdb
--Entradas:
-- Todos los datos correspondientes a los atributos
--del repartidor en la base de datos, mas
--un atributo de numero telefonico que se actualiza en
-- la tabla repartidor_telefonos
--Proceso: Se hace un update con todos los datos
--del repartidor en la tabla repartidor,
--seguido de un update del numero de telefono en la tabla repartidor_telefonos
--CALL UPDATE_REPARTIDOR('luis92','Luis','Vargas', 'Lopez','luisvl@gmail.com','djnd823','Cartago','Paraiso', 'Orosi','45783487',TRUE)
--Procedimiento para caso en el que solo hay un numero telefonico

CREATE OR REPLACE PROCEDURE UPDATE_REPARTIDOR(
	REPARTIDOR_USR VARCHAR(50),
	NOMBRE_REPARTIDOR_SP VARCHAR(50),
	APELLIDO1_REPARTIDOR_SP VARCHAR(50),
	APELLIDO2_REPARTIDOR_SP VARCHAR(50),
	CORREO_REPARTIDOR_SP VARCHAR(50),
	PASS_REPARTIDOR_SP VARCHAR(50),
	PROVINCIA_REPARTIDOR_SP VARCHAR(50),
	CANTON_REPARTIDOR_SP VARCHAR(50),
	DISTRITO_REPARTIDOR_SP VARCHAR(50),
	TELEFONO_REPARTIDOR_SP_1 VARCHAR(8),
	DISPONIBLE_REPARTIDOR_SP BOOLEAN)
	
language plpgsql
as $$
begin
-- stored procedure body
UPDATE REPARTIDOR
SET
USUARIO_REPART = REPARTIDOR_USR,
NOMBRE = NOMBRE_REPARTIDOR_SP,
PRIMER_APELLIDO = APELLIDO1_REPARTIDOR_SP,
SEGUNDO_APELLIDO = APELLIDO2_REPARTIDOR_SP,
CORREO_REPART = CORREO_REPARTIDOR_SP,
PASSWORD_REPART = PASS_REPARTIDOR_SP,
PROVINCIA = PROVINCIA_REPARTIDOR_SP,
CANTON = CANTON_REPARTIDOR_SP,
DISTRITO = DISTRITO_REPARTIDOR_SP,
DISPONIBLE = DISPONIBLE_REPARTIDOR_SP

WHERE USUARIO_REPART = REPARTIDOR_USR;

DELETE FROM REPARTIDOR_TELEFONOS WHERE USUARIO_REPART = REPARTIDOR_USR;

INSERT INTO REPARTIDOR_TELEFONOS
VALUES
(DEFAULT,REPARTIDOR_USR,TELEFONO_REPARTIDOR_SP_1);
end; $$


CREATE OR REPLACE PROCEDURE UPDATE_REPARTIDOR(
	REPARTIDOR_USR VARCHAR(50),
	NOMBRE_REPARTIDOR_SP VARCHAR(50),
	APELLIDO1_REPARTIDOR_SP VARCHAR(50),
	APELLIDO2_REPARTIDOR_SP VARCHAR(50),
	CORREO_REPARTIDOR_SP VARCHAR(50),
	PASS_REPARTIDOR_SP VARCHAR(50),
	PROVINCIA_REPARTIDOR_SP VARCHAR(50),
	CANTON_REPARTIDOR_SP VARCHAR(50),
	DISTRITO_REPARTIDOR_SP VARCHAR(50),
	TELEFONO_REPARTIDOR_SP_1 VARCHAR(8),
	TELEFONO_REPARTIDOR_SP_2 VARCHAR(8),
	DISPONIBLE_REPARTIDOR_SP BOOLEAN)
	
language plpgsql
as $$
begin
-- stored procedure body
UPDATE REPARTIDOR
SET
USUARIO_REPART = REPARTIDOR_USR,
NOMBRE = NOMBRE_REPARTIDOR_SP,
PRIMER_APELLIDO = APELLIDO1_REPARTIDOR_SP,
SEGUNDO_APELLIDO = APELLIDO2_REPARTIDOR_SP,
CORREO_REPART = CORREO_REPARTIDOR_SP,
PASSWORD_REPART = PASS_REPARTIDOR_SP,
PROVINCIA = PROVINCIA_REPARTIDOR_SP,
CANTON = CANTON_REPARTIDOR_SP,
DISTRITO = DISTRITO_REPARTIDOR_SP,
DISPONIBLE = DISPONIBLE_REPARTIDOR_SP

WHERE USUARIO_REPART = REPARTIDOR_USR;

DELETE FROM REPARTIDOR_TELEFONOS WHERE USUARIO_REPART = REPARTIDOR_USR;

INSERT INTO REPARTIDOR_TELEFONOS
VALUES
(DEFAULT,REPARTIDOR_USR,TELEFONO_REPARTIDOR_SP_1),
(DEFAULT,REPARTIDOR_USR,TELEFONO_REPARTIDOR_SP_2);
end; $$

