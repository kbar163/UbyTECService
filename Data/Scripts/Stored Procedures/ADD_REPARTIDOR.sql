--Procedimiento almacenado creado en la base de datos
-- ubytecdb
--Entradas:
-- Todos los datos correspondientes a los atributos
--del repartidor en la base de datos, mas
--un atributo de numero telefonico que se inserta en
-- la tabla repartidor_telefonos
--Proceso: Se hace un insert con todos los datos
--del repartidor en la tabla repartidor,
--seguido de un insert del numero de telefono y usuario
--del repartidor en la tabla repartidor_telefonos
-- Ejemplo de llamada : 
--CALL ADD_REPARTIDOR('luis92','Luis','Vargas', 'Guzman','luisvg@gmail.com','djnd823','Cartago','Paraiso', 'Orosi','45783487','98785463',TRUE)

--Procedimiento para caso en el que solo hay un numero telefonico

CREATE OR REPLACE PROCEDURE ADD_REPARTIDOR(
	REPARTIDOR_USR VARCHAR(50),
	NOMBRE_REPARTIDOR_SP VARCHAR(50),
	APELLIDO1_REPARTIDOR_SP VARCHAR(50),
	APELLIDO2_REPARTIDOR_SP VARCHAR(50),
	CORREO_REPARTIDOR_SP VARCHAR(50),
	PASS_REPARTIDOR_SP VARCHAR(50),
	PROVINCIA_REPARTIDOR_SP VARCHAR(50),
	CANTON_REPARTIDOR_SP VARCHAR(50),
	DISTRITO_REPARTIDOR_SP VARCHAR(50),
	TELEFONO_REPARTIDOR_SP_1 VARCHAR(8),
	DISPONIBLE_REPARTIDOR_SP BOOLEAN)
	
language plpgsql
as $$
begin
-- stored procedure body
INSERT INTO REPARTIDOR
VALUES
(REPARTIDOR_USR,NOMBRE_REPARTIDOR_SP,APELLIDO1_REPARTIDOR_SP,APELLIDO2_REPARTIDOR_SP,
CORREO_REPARTIDOR_SP,PASS_REPARTIDOR_SP,PROVINCIA_REPARTIDOR_SP,CANTON_REPARTIDOR_SP,DISTRITO_REPARTIDOR_SP,
DISPONIBLE_REPARTIDOR_SP);

INSERT INTO REPARTIDOR_TELEFONOS
VALUES
(DEFAULT,REPARTIDOR_USR,TELEFONO_REPARTIDOR_SP_1);
end; $$

--Procedimiento para caso en el que hay 2 numeros telefonicos

CREATE OR REPLACE PROCEDURE ADD_REPARTIDOR(
	REPARTIDOR_USR VARCHAR(50),
	NOMBRE_REPARTIDOR_SP VARCHAR(50),
	APELLIDO1_REPARTIDOR_SP VARCHAR(50),
	APELLIDO2_REPARTIDOR_SP VARCHAR(50),
	CORREO_REPARTIDOR_SP VARCHAR(50),
	PASS_REPARTIDOR_SP VARCHAR(50),
	PROVINCIA_REPARTIDOR_SP VARCHAR(50),
	CANTON_REPARTIDOR_SP VARCHAR(50),
	DISTRITO_REPARTIDOR_SP VARCHAR(50),
	TELEFONO_REPARTIDOR_SP_1 VARCHAR(8),
	TELEFONO_REPARTIDOR_SP_2 VARCHAR(8),
	DISPONIBLE_REPARTIDOR_SP BOOLEAN)
	
language plpgsql
as $$
begin
-- stored procedure body
INSERT INTO REPARTIDOR
VALUES
(REPARTIDOR_USR,NOMBRE_REPARTIDOR_SP,APELLIDO1_REPARTIDOR_SP,APELLIDO2_REPARTIDOR_SP,
CORREO_REPARTIDOR_SP,PASS_REPARTIDOR_SP,PROVINCIA_REPARTIDOR_SP,CANTON_REPARTIDOR_SP,DISTRITO_REPARTIDOR_SP,
DISPONIBLE_REPARTIDOR_SP);

INSERT INTO REPARTIDOR_TELEFONOS
VALUES
(DEFAULT,REPARTIDOR_USR,TELEFONO_REPARTIDOR_SP_1),
(DEFAULT,REPARTIDOR_USR,TELEFONO_REPARTIDOR_SP_2);
end; $$

